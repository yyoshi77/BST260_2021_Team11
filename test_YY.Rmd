---
title: "Test_Scraping"
author: "YYoshikawa, BST260 AY2021-22 Team #11"
date: "11/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction/Backgrounds

Intro and something here. 

```{r}
```

## Data collection

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(rvest)
library(lubridate)
```

```{r, warning=FALSE}
# URL of Men at Tokyo2020
url_20m <- "https://www.watchathletics.com/page/2560/tokyo-olympics-men-s-marathon-results"

# Extract all tables in the page
tab <- read_html(url_20m) %>% 
  html_nodes("body") %>% 
  html_nodes("table") 
dat_20m <- tab[1] %>% 
  html_table() %>%
  .[[1]] %>% 
  slice(-1)

colnames(dat_20m) <- c("rank", "athlete", "country_ab", "time")

# Data reshaping
dat_20m <- dat_20m %>% 
  mutate(rank = as.integer(rank)) %>% 
  mutate(sb = ifelse(str_ends(time, " SB"), 1, 0)) %>% # SB means 'season best'
  mutate(time = str_replace(time, " SB", "")) %>% 
  mutate(dnf = ifelse(time=="DNF", 1, 0)) %>% # DNF means 'did not finish'
  mutate(time = hms(time)) # change into date and time data

dat_20m

# URL of Women at Tokyo2020
url_20w <- "https://en.wikipedia.org/wiki/Athletics_at_the_2020_Summer_Olympics_%E2%80%93_Women%27s_marathon"

# Extract all tables in the page
tab <- read_html(url_20w) %>% 
  html_nodes("table") 
dat_20w <- tab[8] %>% 
  html_table() %>%
  .[[1]] 

colnames(dat_20w)[1:4] <- c("rank", "athlete", "country", "time")

# Data reshaping
dat_20w$rank[1:3] <- c(1:3)
dat_20w <- dat_20w %>% 
  mutate(rank = ifelse(rank=="â€“", NA, rank)) %>% 
  mutate(sb = ifelse(is.na(rank), NA, 0)) %>% 
  mutate(sb = ifelse(Notes %in% c("SB","NR"), 1, sb)) %>% 
  mutate(dnf = ifelse(time=="DNF", 1, 0)) %>% 
  mutate(time = hms(time)) %>% 
  select(rank, athlete, country, time, sb, dnf)

dat_20w
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
