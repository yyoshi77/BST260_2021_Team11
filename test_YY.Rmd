---
title: "Test_Scraping"
author: "YYoshikawa, BST260 AY2021-22 Team #11"
date: "11/5/2021"
output: html_document
---

## Introduction/Backgrounds

Intro and something here. 

```{r}
```

## Data collection

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(rvest)

```

```{r, warning=FALSE}
# URL of Men at Tokyo2020
url_20m <- "https://en.wikipedia.org/wiki/Athletics_at_the_2020_Summer_Olympics_%E2%80%93_Men%27s_marathon"

# Extract all tables in the page
tab <- read_html(url_20m) %>% 
  html_nodes("table") 
dat_20m <- tab[8] %>% 
  html_table() %>%
  .[[1]]

colnames(dat_20m)[1:4] <- c("rank", "athlete", "country", "time")

# Data reshaping
dat_20m$rank[1:3] <- c(1:3)
dat_20m <- dat_20m %>% 
  mutate(rank = ifelse(rank=="—", NA, rank)) %>% 
  mutate(sb = ifelse(is.na(rank), NA, 0)) %>% 
  mutate(sb = ifelse(Notes %in% c("SB","NR"), 1, sb)) %>% 
  mutate(dnf = ifelse(Notes=="DNF", 1, 0)) %>% 
  mutate(time = lubridate::hms(time)) %>% 
  select(rank, athlete, country, time, sb, dnf)

if (!require(knitr)) {install.packages("knitr", dependencies=TRUE)}
knitr::kable(dat_20m %>% slice(1:8))

# URL of Women at Tokyo2020
url_20w <- "https://en.wikipedia.org/wiki/Athletics_at_the_2020_Summer_Olympics_%E2%80%93_Women%27s_marathon"

# Extract all tables in the page
tab <- read_html(url_20w) %>% 
  html_nodes("table") 
dat_20w <- tab[8] %>% 
  html_table() %>%
  .[[1]] 

colnames(dat_20w)[1:4] <- c("rank", "athlete", "country", "time")

# Data reshaping
dat_20w$rank[1:3] <- c(1:3)
dat_20w <- dat_20w %>% 
  mutate(rank = ifelse(rank=="–", NA, rank)) %>% 
  mutate(sb = ifelse(is.na(rank), NA, 0)) %>% 
  mutate(sb = ifelse(Notes %in% c("SB","NR"), 1, sb)) %>% 
  mutate(dnf = ifelse(Notes=="DNF", 1, 0)) %>% 
  mutate(time = lubridate::hms(time)) %>% 
  select(rank, athlete, country, time, sb, dnf)

knitr::kable(dat_20w %>% slice(1:8))

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
